# export $(grep -v '^#' .env | xargs)
command git 2>/dev/null || (apk add git 2>/dev/null) || (apt update 2>/dev/null && apt install -y git) || (yum -y install git 2>/dev/null)

git clone https://github.com/AlexBurnes/practice-sort_keys  /practice-sort_keys
cd /practice-sort_keys
if [ ! -z "${BRANCH-}" ]; then
  git checkout ${BRANCH}
fi
git submodule init
git submodule update

echo "üîç platform"
buildfab platform-view -v

echo "üîß install system requirements"
buildfab ci-pre-install -vv

echo "üîß install build tools requirements"
buildfab pre-install -vv

OS=$(scripts/version os)
OS_VERSION=$(scripts/version os_version)

echo -e "üîß init conan cache"
if [ -d /tmp/buildfab-cache-conan ]; then
    CACHE_DIR=/tmp/buildfab-cache-conan/${OS}${OS_VERSION}/.conan2
    mkdir -p ${CACHE_DIR}
    rm -fr ${HOME}/.conan2
    ln -s ${CACHE_DIR} ${HOME}/.conan2
    conan profile detect --force
    profile_path=$(dirname $(conan profile path default))
    cp ${profile_path}/default ${profile_path}/debug
    sed -i -e 's/Release/Debug/g' ${profile_path}/debug
fi



